<!DOCTYPE html>
<html>
<head>
<title>Multi Tone or Grayscale Encoders</title>
<script>
function setupCanvas(dia)
{
	var c = document.getElementById("encoderCanvas");
	var ctx = c.getContext("2d");
	ctx.canvas.width  = dia;
	ctx.canvas.height  = dia;
	ctx.clearRect(0, 0, c.width, c.height);
	ctx.translate(c.width/2, c.height/2); //set origin to middle
	ctx.lineWidth = 2;
	return ctx;
}
function setupCanvasDemo(canvasID, dia)
{
	var c = document.getElementById(canvasID);
	var ctx = c.getContext("2d");
	ctx.canvas.width  = dia;
	ctx.canvas.height  = dia;
	ctx.clearRect(0, 0, c.width, c.height);
	ctx.translate(c.width/2, c.height/2); //set origin to middle
	ctx.lineWidth = 2;
	return ctx;
}
//Cut a hole in the middle if the checkbox is checked
function holeInMiddle(hole, ctx, dia)
{
	if(hole)
	{
		ctx.beginPath();
		ctx.arc(0, 0, dia, 0, 2 * Math.PI);
		ctx.stroke();
		ctx.fillStyle = "rgb(255,255,255)";
		ctx.fill();
	}
}
function makeEncoder()
{
	//get encoder type
	var encoderType = document.querySelector('input[name="encoderType"]:checked').value;
	//get wheel diameter in pixels
	var dia = parseInt(document.getElementById('wheelDiameter').value);
	if(!dia)
	{
		dia = 500;
	}
	//get number of encodings or divisions
	var anglediv = parseInt(document.getElementById('wheelFrequency').value);
	if(!anglediv)
	{
		anglediv = 18;
	}
	//get build a hole
	var hole = document.querySelector('input[id="hole"]').checked;
	//get if human readable type
	var human = document.querySelector('input[id="human"]').checked;
	switch(encoderType)
	{
			case "standard": standardEncoder(0,anglediv,dia,hole,1,human);break;
			case "threetone": standardEncoder(0,anglediv,dia,hole,2,human);break;
			case "fourtone": standardEncoder(0,anglediv,dia,hole,3,human);break;
			case "grayscale": standardEncoder(0,anglediv,dia,hole,anglediv,human);break;
			case "colorscale": colorEncoder(0,anglediv,dia,hole,anglediv,human,0);break;
			case "rgbtone": colorEncoder(0,anglediv,dia,hole,3,human,1);break;
			case "default": standardEncoder(0,anglediv,dia,hole,1,human,1);
	}
}

function standardEncoder(demo,anglediv,dia,hole,colors,human)
{
	var ctx ;
	if(demo)
	{
		ctx = setupCanvasDemo(demo, dia);
	}
	else
	{
		ctx = setupCanvas(dia);
	}

	//regular adjustments
	var angleIncrement = (2 * Math.PI)/anglediv;
	var color = 255;
	var colorIncrement = Math.floor(255/colors);
	var n = 0;
	var t = 1;

	//these two lines are for human readable encoders
	var fontsize = angleIncrement*200*dia/500;
	ctx.font = fontsize +'px serif'; //set text style
	if (human)
	{
		t=0.5;
	}

	while (anglediv > 0)
	{
		ctx.beginPath();
		ctx.moveTo(0,0);
		ctx.arc(0, 0, (dia/2)-10, -angleIncrement, 0);
		ctx.fillStyle = "rgba("+color+","+color+","+color+","+t+")";
		ctx.fill();

		if(human)
		{
			if(0 != anglediv)
			{
				//make black line
				ctx.beginPath();
				ctx.moveTo(0, 0);
				ctx.lineTo((dia/2)-10, 0);
				ctx.stroke();
				ctx.strokeText(anglediv-1, (dia/2)-fontsize*2, -2);
			}
		}

		ctx.rotate(angleIncrement);
		anglediv -=1;
		//sets color
		color -= colorIncrement;
		n+=1;
		if (n>colors)
		{
			n=0;
			color = 255;
		}
	}
	holeInMiddle(hole, ctx, dia/8);
}

function colorEncoder(demo,anglediv,dia,hole,colors,human,rgb)
{
	var ctx ;
	if(demo)
	{
		ctx = setupCanvasDemo(demo, dia);
	}
	else
	{
		ctx = setupCanvas(dia);
	}

	//regular adjustments
	var angleIncrement = (2 * Math.PI)/anglediv;
	var hue = 360; //hue of color
	var colorIncrement = Math.floor(360/colors);
	var n = 0;
	var light = "50%"; //lightnes of HSL
	var sat = "100%";
	var t = 1;

	//these two lines are for human readable encoders
	var fontsize = angleIncrement*200*dia/500;
	ctx.font = fontsize +'px serif'; //set text style
	if (human)
	{
		t=0.5;
	}

	while (anglediv > 0)
	{
		ctx.beginPath();
		ctx.moveTo(0,0);
		ctx.arc(0, 0, (dia/2)-10, -angleIncrement, 0);

		ctx.fillStyle = 'hsla('+ hue +','+ sat +','+ light +','+t+')';
		ctx.fill();

		if(human)
		{
			if(0 != anglediv)
			{
				//make black line
				ctx.beginPath();
				ctx.moveTo(0, 0);
				ctx.lineTo((dia/2)-10, 0);
				ctx.stroke();
				ctx.strokeText(anglediv-1, (dia/2)-fontsize*2, -2);
			}
		}

		ctx.rotate(angleIncrement);
		anglediv -=1;
		//sets color
		hue -= colorIncrement;
		n+=1;
		if (rgb)
		{
			if (n==colors) //makes a white line  after the colors
			{
				light = "100%";
			}
		}
		if (n>colors)
		{
			n=0;
			hue = 0;
			light = "50%";
		}
	}
	holeInMiddle(hole, ctx, dia/8);
}

</script>
</head>
<body>
<h1>Encoders</h1>
<p>Make your own custom encoder.  See below for examples of the different types.</p>
<div><input type="checkbox" id="hole" name="hole" checked>
<label for="hole">Include a hole in the middle</label></div>
<div><label for="wheelFrequency">Number of Encodings</label> <input id="wheelFrequency" name="numberWheelFrequencyGray" value="40" onkeyup="makeEncoder();"></input></div>
<div><label for="wheelDiameter">Diameter</label> <input id="wheelDiameter" name="wheelDiameter" value="500" onkeyup="makeEncoder();"></input></div>
<fieldset>
	<legend>Choose the type of encoder</legend>
<input type="radio" id="standard" name="encoderType" value="standard" checked onchange="makeEncoder();">
<label for="standard">Standard Encoder</label><br>
<input type="radio" id="threetone" name="encoderType" value="threetone" onchange="makeEncoder();">
<label for="threetone">3 Tone Encoder</label><br>
<input type="radio" id="fourtone" name="encoderType" value="fourtone" onchange="makeEncoder();">
<label for="fourtone">4 Tone Encoder</label><br>
<input type="radio" id="grayscale" name="encoderType" value="grayscale" onchange="makeEncoder();">
<label for="grayscale">Grayscale Encoder</label><br>
<input type="radio" id="colorscale" name="encoderType" value="colorscale" onchange="makeEncoder();">
<label for="colorscale">Color Encoder</label><br>
<input type="radio" id="rgbtone" name="encoderType" value="rgbtone" onchange="makeEncoder();">
<label for="rgbtone">RGB Encoder</label><br>
</fieldset>
<div><input type="checkbox" id="human" name="human" onchange="makeEncoder();"><label for="human">Make Human Readable</label></div>
<canvas id="encoderCanvas" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>makeEncoder();</script>

<h1>Demonstrations</h1>
<h2>Standard Encoder</h2>
<p>This is a pretty standard encoder pattern. An even number must be entered below for a regular pattern.</p>
<br />
<canvas id="standardCanvas" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>standardEncoder("standardCanvas",40,500,0,1,0);</script>

<br/>
<h2>3 tone Encoder</h2>
<p>This encoder pattern should be recognized by an analog encoder.  This could be used to tell if the wheels are moving in either direction.
The vehicle could be moving either forward or backward. A number divisible by three must be used to give a regular pattern. The following example has 36 divisions.</p>
<canvas id="threeToneCanvas" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>standardEncoder("threeToneCanvas",36,500,0,2,0);</script>
<br />

<h2>4 tone Encoder</h2>
<p>Maybe, more shades could benefit different applications.  A number divisible by four must be used to give a regular pattern. The following example has 20 divisions.</p>
<canvas id="fourToneCanvas" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>standardEncoder("fourToneCanvas",20,500,0,3,0);</script>

<h2>Multitone or Grayscale Encoder</h2>
<p>This encoder pattern could be used to tell exactly where in each revolution a wheel has been turned.
This assumes the printing is consistent. The following example has 18 divisions.</p>
<canvas id="grayscaleCanvas" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>standardEncoder("grayscaleCanvas",18,500,0,18,0);</script>
<br />

<h2>Human Readable Encoder - Grayscale</h2>
<p>This is a modified 4 color grayscale encoder pattern for a person to count with. A number divisible by 4 must be given to give a nice pattern.</p>
<canvas id="numberWheelCanvasGray" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>standardEncoder("numberWheelCanvasGray",18,500,0,18,1);</script>

<br />
<h2>Color Wheel</h2>
<p>At this point, I was just having fun making a color wheel.  I do not see this being used as a wheel encoder.</p>
<canvas id="colorWheelCanvas" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>colorEncoder("colorWheelCanvas",18,500,0,18,0);</script>


<h2>Human Readable Encoder - Color</h2>
<p>This is a encoder pattern for a person to count with.</p>
<canvas id="numberWheelCanvas" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>colorEncoder("numberWheelCanvas",18,500,0,18,1,0);</script>

<h2>Human Readable Encoder - RGB</h2>
<p>This is a modified 4 color encoder pattern for a person to count with. A number divisible by 4 must be given to give a nice pattern.</p>
<canvas id="numberWheelCanvasRGB" width="500" height="500" style="">
Your browser does not support the HTML5 canvas tag.</canvas>
<script>colorEncoder("numberWheelCanvasRGB",18,500,0,3,1,1);</script>
</body>
</html>
